# chromis_tracking README: Process and Improve Tracks Generated by yolov8 botsort
## Overview
The provided script is designed to process and improve the object tracking results generated by the YOLOv8 BotSort algorithm. It not only interpolates the missing detections in tracks but also identifies, corrects, and merges overlapping tracks in video sequences.

## Code Description
### Main Function
process_and_merge_tracks(mot_file_path, video_path): Processes and merges overlapping tracks based on the provided MOT file and video.

### Sub-functions
interpolate_tracks(tracking_data): Interpolates missing detection data for each track between its first and last detection.

draw_bounding_boxes_on_video(video_path, mot_data, output_video_path): Draws bounding boxes and their corresponding track IDs on the video.

subtract_median_background_with_morph(video_path, output_path, kernel_size=1, iterations=1): Subtracts the median background from a video and performs erosion/dilation to remove small features.

check_overlap(rect1, rect2): Checks if two rectangles overlap.

check_for_duplicate_ids(tracking_data): Checks for rows in the tracking data with the same frame ID and object ID.

track_object(trackID, start_frame, end_frame, tracking_data, video_path): Track objects between the start and end frames of a video.

handle_overlap(tracking_data, track_id_1, track_id_2, tracked_data): Handle overlapping tracks by merging and updating the tracking data.

correct_duplicate_ids(tracking_data): Corrects duplicate object IDs in the tracking data.

remove_short_tracks(tracked_data, min_detections=60): Removes tracks from the tracking data that have fewer than a specified number of detections.

remove_static_tracks(tracked_data, window_size=20, move_threshold=10): Removes static tracks from the tracking data based on a moving average position comparison.

process_tracks(tracking_data, total_frames, video_path): Processes all tracks in the tracking data and merges overlapping tracks.

load_video_properties(video_path): Loads properties of the video like FPS, width, height, and total frames.

## Utilities
The script also includes utility functions to visualize the tracking results, load video properties, and process all videos in a given directory.

## How to Adapt to a New Dataset
Prepare Your Data: Ensure your tracking data is in the format specified by the column_names variable: ['frame_id', 'object_id', 'x', 'y', 'width', 'height', 'confidence', 'class', 'visibility'].

Set Paths: Modify the tracking_data_path and video_path variables to point to your tracking data and video respectively.

Run the Script: Simply run the process_and_merge_tracks function with the paths set in the previous step.

Batch Processing: If you have a directory with multiple videos and corresponding tracking data, use the process_all_videos_in_tracking_dir function. Provide the root directory path to the tracking_dir_path variable and run the function.

Tune Parameters: You might need to tune some of the parameters based on the specific characteristics of your dataset. For instance:

min_detections in remove_short_tracks: The minimum number of detections a track must have to be retained.
move_threshold in remove_static_tracks: The minimum distance the moving average position of a track at time t must move from its initial moving average.

### Requirements
The script requires the following Python libraries:

OpenCV (cv2)
NumPy (numpy)
pandas (pd)
scipy

### Notes
Always backup your data before using the script to avoid any data loss.
It's advisable to first test the script on a subset of your data to ensure it works as expected.
Remember to adjust parameters according to your dataset needs and video characteristics.
